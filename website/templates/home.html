{% extends "base.html" %}
{% block title %}Home Page{% endblock %}

{% block content %}
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://kit.fontawesome.com/a2160caea7.js" crossorigin="anonymous"></script>
  
  

    <style>
      /* Modify the background color */
      
      .card {
          background-color: white;
      }
      .card-header {
          background-color: pink;
          display: inline-flex;
  
      }
      .card-body {
          background-color: white;
  
      }
      
      button[class^="favourite_button"] {
          background-color: pink;
          border:none;
          outline:none;
          color: red;
      }

      .unfavourite_button {
          background-color: pink;
          border:none;
          outline:none;
          color: red;
      }
    </style>

</head> 

<body class="bg">
  <button class = "like_btn">
    <span id ="testing"><i class="fa-solid fa-heart"></i></span>
  </button>
  <script type="text/javascript">
    const likeBtn = document.querySelector(".like_btn");
    let likeIcon = document.querySelector("#testing");
    var clicked = false;
    likeBtn.addEventListener("click", () => {
      if (!clicked) {
        clicked = true;
        likeIcon.innerHTML = '<i class="fa-solid fa-heart"></i>';
      }else{
        clicked = false;
        likeIcon.innerHTML = '<i class="fa-regular fa-heart"></i>';
      }
    });
  </script> 
  <button class = "like_btn_1">
    <span id ="testing_1"><i class="fa-solid fa-heart"></i></span>
  </button>
  <script type="text/javascript">
    var x = "_1"
    var clicked = false;
    document.querySelector(".like_btn" + x).addEventListener("click", () => {
      if (!clicked) {
        clicked = true;
        document.querySelector("#testing" + x).innerHTML = '<i class="fa-solid fa-heart"></i>';
      }else{
        clicked = false;
        document.querySelector("#testing" + x).innerHTML = '<i class="fa-regular fa-heart"></i>';
      }
    });
  </script> 
  <button class="favourite_button-1">
    <span id ="favourite_button_id-1"><i class="fa-regular fa-heart"></i></span>
  </button>

  <script type="text/javascript">
    const favouriteBtn = document.querySelector(".favourite_button-1");
    let favouriteIcon = document.querySelector("#favourite_button_id-1");
    let clicked = false;
    favouriteBtn.addEventListener("click", () => {
      if (!clicked) {
        clicked = true;
        favouriteIcon.innerHTML = '<i class="fa-solid fa-heart"></i>';
      }else{
        clicked = false;
        favouriteIcon.innerHTML = '<i class="fa-regular fa-heart"></i>';
      }
    });
  </script> 
  
  
  <div id="properties" class="card-body mx-auto bg-pink" style="width: 30rem;">
    {% for entry in data %}
      <div class="card mb-3">
        <div class="card-header">
          <strong><a href ="{{ url_for('views.flat_details', flatId=entry[0]) }}" target = "_blank">{{entry[1]}}</strong></a>
          <button class="favourite_button" type="button" onClick="favourite({{  entry[0] }})">
            <span id ="favourite_button_id"><i class="fa-regular fa-heart"></i></span>
          </button>
          <script type="text/javascript">
            document.querySelector(".favourite_button").className = ("favourite_button" + entry[0].toString());
            document.querySelector("#favourtie_button_id").id = ("favourite_button_id" + entry[0].toString());
          </script>
          
          
          {% for favourite in user.favourites %}
            {% if entry[0] == favourite.flat_id %}
            <script type="text/javascript">
              console.log('gigigigi');
              window['click' + entry[0].toString()] = true;
            </script>
            {% endif %}               
          {% endfor %}

          <script type="text/javascript">
            if (window['click' + entry[0].toString()]) {
              window['click' + entry[0].toString()] = false;
              document.querySelector("#favourite_button_id" + entry[0].toString()).innerHTML = '<i class="fa-solid fa-heart"></i>';
            }else{
              window['click' + entry[0].toString()] = true;
              document.querySelector("#favourite_button_id" + entry[0].toString()).innerHTML = '<i class="fa-regular fa-heart"></i>';
            };

            document.querySelector(".favourite_button" + entry[0].toString()).addEventListener("click", () => {
              if (window['click' + entry[0].toString()]) {
                window['click' + entry[0].toString()] = false;
                document.querySelector("#favourite_button_id" + entry[0].toString()).innerHTML = '<i class="fa-solid fa-heart"></i>';
              }else{
                window['click' + entry[0].toString()] = true;
                document.querySelector("#favourite_button_id" + entry[0].toString()).innerHTML = '<i class="fa-regular fa-heart"></i>';
              }
            });
          </script>
          
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col">
              <img src="{{entry['image']}}" class="img-thumbnail">
            </div>
            <div class="col">
              <p><strong>Price: </strong>${{entry[2]}}</p>
              <br/>
              <p><strong>Flat Type: </strong>{{entry[3]}}</p>
              <br/>
              <p><strong>Floor: </strong>{{entry[4]}}</p>
              
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
        
    

<script type="text/javascript">

  var index = 20;
  var limit = 20;

  $(window).scroll(() => {
    var current_y = $(window).scrollTop();
    var window_height = $(window).height();
    var document_height = $(document).height();
    
    if (current_y + window_height  == document_height) {
      downloadContent(index, limit);
      index += 10
    }
  });


  function downloadContent(index, limit) {
    $.get('/api?index=' + index + '&limit=' + limit, (data) => {
      for (var index = 0; index < data.data.length; index++) {
        var entry = "/flat-details/" + data.data[index][0];  
        var page = `
          <div class="card mb-3">
            <div class="card-header">
              <strong>` +`<a href="${entry}" target = "_blank">`+ data.data[index][1] + `</strong></a>
            </div> 
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <img src="` + data.data[index].image + `" class="img-thumbnail">
                </div>
                <div class="col">
                  <p><strong>Price: </strong>` +`$`+ data.data[index][2] + `</p>
                  <br/>
                  <p><strong>Flat Type: </strong>` + data.data[index][3] + `</p>
                  <br/>
                  <p><strong>Floor: </strong>` + data.data[index][4] + `</p>
                </div>
              </div>
            </div>
          </div>
        `

        $('#properties').append(page)
      }
    });
  }
  
  </script>

  </body>
{% endblock %}
