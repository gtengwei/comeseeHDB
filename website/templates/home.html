{% extends "base.html" %}
{% block title %}Home Page{% endblock %}

{% block content %}
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://kit.fontawesome.com/a2160caea7.js" crossorigin="anonymous"></script>
  
  <script>
    var heart_type = document.getElementById("favourite_button");
    heart_type.setAttribute = ('class', "fa-solid fa-heart");
  </script>

    <style>
      /* Modify the background color */
      
      .card {
          background-color: white;
      }
      .card-header {
          background-color: pink;
          display: inline-flex;
  
      }
      .card-body {
          background-color: white;
  
      }
      
      .favourite_button {
          background-color: pink;
          border:none;
          outline:none;
          color: red;
      }

      .unfavourite_button {
          background-color: pink;
          border:none;
          outline:none;
          color: red;
      }
    </style>

</head> 

<body class="bg">
  <div id="properties" class="card-body mx-auto bg-pink" style="width: 30rem;">
    
    {% for entry in data %}
      <div class="card mb-3">
        <div class="card-header">
          <strong><a href ="{{ url_for('views.flat_details', flatId=entry[0]) }}" target = "_blank">{{entry[1]}}</strong></a>
          <button class="favourite_button" type="button" onClick="favourite({{  entry[0] }})">
            <span><i id="favourtie_button" class="fa-regular fa-heart"></i></span>
          </button>  
              {% for favourite in user.favourites %}
                {% if entry[0] == favourite.flat_id %}
                <button class="unfavourite_button" type="button" onClick="unfavourite({{  favourite.id }})">
                  <span><i id="favourtie_button" class="fa-solid fa-heart"></i></span>
                </button>
                {% endif %}               
              {% endfor %}
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col">
              <img src="{{entry['image']}}" class="img-thumbnail">
            </div>
            <div class="col">
              <p><strong>Price: </strong>${{entry[2]}}</p>
              <br/>
              <p><strong>Flat Type: </strong>{{entry[3]}}</p>
              <br/>
              <p><strong>Floor: </strong>{{entry[4]}}</p>
              
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
        

  

<script type="text/javascript">
  var index = 20;
  var limit = 20;

  $(window).scroll(() => {
    var current_y = $(window).scrollTop();
    var window_height = $(window).height();
    var document_height = $(document).height();
    
    if (current_y + window_height  == document_height) {
      downloadContent(index, limit);
      index += 10
    }
  });


  function downloadContent(index, limit) {
    $.get('/api?index=' + index + '&limit=' + limit, (data) => {
      for (var index = 0; index < data.data.length; index++) {
        var entry = "/flat-details/" + data.data[index][0];   
        var page = `
          <div class="card mb-3">
            <div class="card-header">
              <strong>` +`<a href="${entry}" target = "_blank">`+ data.data[index][1] + `</strong></a>
            </div> 
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <img src="` + data.data[index].image + `" class="img-thumbnail">
                </div>
                <div class="col">
                  <p><strong>Price: </strong>` +`$`+ data.data[index][2] + `</p>
                  <br/>
                  <p><strong>Flat Type: </strong>` + data.data[index][3] + `</p>
                  <br/>
                  <p><strong>Floor: </strong>` + data.data[index][4] + `</p>
                </div>
              </div>
            </div>
          </div>
        `

        $('#properties').append(page)
      }
    });
  }
  
  </script>

  </body>
{% endblock %}
